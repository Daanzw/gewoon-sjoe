<!DOCTYPE html>
<html>
<head>
	<title>gewoon sjoe</title>
</head>
<body>
<canvas  id="myCanvas" width="1024" height="470"></canvas>
<script src="./bower_components/jquery/dist/jquery.min.js"></script>
<script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
<script type="text/javascript">

    	var canvas = document.getElementById("myCanvas");
    	// Gravity, how fast it goes down
    	var gravity = 0.3;
    	var j = 5;
        var spaces = new Array();

    	// Whether or not the up key is pressed
		var keypressed = false;
    	var sources = {
        bg: './assets/bg.jpg',
        ground: './assets/ground.png',
        sjoe: './assets/sjoe.png',
        alian: './assets/alian.png',
        penny: './assets/penny.png'
      };

		var ctx = canvas.getContext("2d");
	
		// Make sure the image is loaded first otherwise nothing will draw.
	  	loadImages(sources, function(images) {
  
  			function Sjoe(x, y) {
    			this.x = x;
    			this.y = y;
    			// How fast we are moving
    			this.velocity = 10;
    			this.image =images.sjoe ;

			}
            function Penny(x,y){
                this.x = x;
                this.y = y;
                    this.image =images.penny ;
            }


			Sjoe.prototype.draw = function () {

    			ctx.drawImage(this.image, this.x, this.y,80,160);
			}
			Sjoe.prototype.update = function() {
		    	// Check if we are underground
    			if (this.y + this.velocity + 36 > 275) {
        			// If so, move us back to ground level and set velocity to zero
        			this.velocity = 0;
        			this.y = 275 - 36;
    			} else {
        			// Otherwise, move what is indicated by velocity
        			this.velocity += gravity;
        			this.y += this.velocity;
    			}	 
			}

            Penny.prototype.draw = function (a) {
                ctx.drawImage(this.image, this.x+ spaces[a], this.y,30,30);
            }
            Penny.prototype.update = function() {
                
                // if (this.y < (sjoe1.y+160) && this.y > sjoe1.y && this.x > sjoe1.x && this.x < (sjoe1.x+80) ) {
                //     console.log("touch");
                   
                // }
                // else{
                   
                // }
                this.x =  canvas.width-30-(j);
            }
            var pennies = new Array();
            for (var i = 0; i <= 1000; i++) {
               pennies.push( new Penny(canvas.width, Math.floor((Math.random() * 275) + 1) +50 ));
               spaces.push(Math.floor((Math.random() * 200000  ) + 1));

            }
            console.log(pennies);
         
			var sjoe1 = new Sjoe(400, 275);
			var requestAnim = window.requestAnimationFrame ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    setInterval;

            requestAnim(function loop() {
    			// Clear the screen
    			ctx.clearRect(0, 0, canvas.width, canvas.height);
    			ctx.drawImage(images.bg, 0,0);
                // ctx.drawImage(images.alian, 400-(j/3),250,60,60);
                // for (var i = 0; i*(images.bg.width)-(j/2) < canvas.width ; i++) {
                //     ctx.drawImage(images.bg, i*(images.bg.width)-(j/2), 0);
                // }

    			for (var i = 0; i*(images.ground.width)-(j) < canvas.width ; i++) {
				ctx.drawImage(images.ground, i*(images.ground.width)-(j) , 400);
	  			}
	  			j++;
	       		// Redraw the grass where it is supposed to be
                for (var i = 0; i <=1000; i++) {
                    pennies[i].draw(i);
                }
                sjoe1.draw();
       			// If the key is pressed, set velocity to -5
    			if (keypressed) {
        			sjoe1.velocity = -5;
        			keypressed = false;
    			}
                for (var i = 0; i <=1000; i++) {
                    pennies[i].update();
                }
    	
                sjoe1.update();
                
                j++;

    			// Do again
    			requestAnim(loop);
			});
                  console.log(sjoe1.y);

            // keypresses=true by press of space
			document.addEventListener('keydown', function (e) {
    
    			if (e.keyCode == '32') {
        			keypressed = true;
    			}
			}, false);
            
            //check of it is a mobile
            var isMobile = {
                Android: function() {
                    return navigator.userAgent.match(/Android/i);
                },
                BlackBerry: function() {
                    return navigator.userAgent.match(/BlackBerry/i);
                },
                iOS: function() {
                    return navigator.userAgent.match(/iPhone|iPad|iPod/i);
                },
                Opera: function() {
                    return navigator.userAgent.match(/Opera Mini/i);
                },
                Windows: function() {
                    return navigator.userAgent.match(/IEMobile/i);
                },
                any: function() {
                    return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
                }
            };
            // keypresses=true by touch or click
			$('#myCanvas').on(isMobile ? 'touchend' : 'click', function () { 
  				keypressed = true; 
			});





	
			
	  });
        
 


	  function loadImages(sources, callback) {
        var images = {};
        var loadedImages = 0;
        var numImages = 0;
        // get num of sources
        for(var src in sources) {
          numImages++;
        }
        for(var src in sources) {
          images[src] = new Image();
          images[src].onload = function() {
            if(++loadedImages >= numImages) {
              callback(images);
            }
          };
          images[src].src = sources[src];
        }
      }
</script>

</body>
</html>